<?

class Turtle {
	protected $x = 0;
	protected $y = 0;
	protected $direction = 0;
	protected $pen_down = true;
	protected $gd_image;
	protected $color;
	public $font = 'arial.ttf';
	function __construct($gd_image) {
		$this->gd_image = $gd_image;
		$this->color = imagecolorallocate($gd_image, 0, 0, 0);
		putenv('GDFONTPATH=' . realpath('.'));
	}
	function move($distance) {
		$dx = $distance * sin(deg2rad($this->direction));
		$dy = $distance * cos(deg2rad($this->direction));
		if ($this->pen_down) {
			imageline(
				$this->gd_image,
				$this->x,
				$this->y,
				$this->x + $dx,
				$this->y + $dy,
				$this->color
			);
		}
		$this->x = $this->x + $dx;
		$this->y = $this->y + $dy;
	}
	function write($text, $size=20) {
		imagettftext(
			$this->gd_image, 
			$size, 
			($this->direction)-90, 
			$this->x, 
			$this->y, 
			$this->color, 
			'arial.ttf', 
			$text
		);
	}
	function goto($x, $y) {
		$this->x = $x;
		$this->y = $y;
	}
	function rotate($rotation) {
		$this->direction += $rotation;
		if ($this->direction >= 360) {
			$this->direction -= 360;
		}
	}
	function set_color($r, $g, $b, $a) {
		$this->color = imagecolorallocatealpha($this->gd_image, $r, $g, $b, $a);
	}
	function pen_up() {
		$this->pen_down = false;
	}
	function pen_down() {
		$this->pen_down = true;
	}
	function pen_toggle() {
		$this->pen_down = ! $this->pen_down;;
	}
}

?>
